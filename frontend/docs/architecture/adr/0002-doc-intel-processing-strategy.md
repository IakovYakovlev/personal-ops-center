# ADR 0002: Processing Strategy (Synchronous + Asynchronous)

- **Статус:** Accepted
- **Дата:** 2026-02-22
- **Автор:** Iakov
- **Область (Scope):** doc-intelligence

## Контекст (Context)

Doc Intelligence должен демонстрировать как быстрый анализ небольших документов, так и надежную обработку длительных задач. Пользовательский опыт требует простой, предсказуемой схемы действий, а инфраструктура должна выдерживать переменные задержки (LLM), лимиты (5MB), и rate limiting.

## Варианты решения (Considered Options)

1. **Только Synchronous:** Все запросы обрабатываются в реальном времени.
2. **Только Asynchronous:** Все запросы становятся фоновыми задачами с очередью.
3. **Две стратегии (Synchronous + Asynchronous):** Пользователь выбирает подход, в зависимости от сценария.

## Решение (Decision Outcome)

Выбран Вариант 3. UI предоставляет выбор между Synchronous (Direct Scan) и Asynchronous (Cloud Task). Это позволяет демонстрировать два типа обработки и адаптировать UX к ожиданиям пользователя.

### Обоснование (Pros)

- Быстрый путь для небольших файлов без ожидания очереди.
- Надежный путь для долгих задач с мониторингом прогресса.
- Демонстрация архитектуры очередей и job processing.

### Недостатки (Cons)

- Усложнение фронтенда: нужно поддерживать две логики и UI состояния.
- Требуется поллинг или события для asynchronous режима.

## Последствия (Consequences)

- Frontend поддерживает выбор стратегии и различное отображение прогресса.
- Backend предоставляет sync endpoint и async job endpoint.
- Хранение статусов задач и выдача прогресса для UI.
- Rate limiting и ограничения размера файла применяются в обоих режимах.

## Связи (Links)

- Ссылается на: [ADR 0001](0001-global-auth-strategy.md)
